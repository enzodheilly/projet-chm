{% extends 'admin/base_admin.html.twig' %}

{% block title %}Modifier une licence
{% endblock %}

{% block stylesheets %}
	<style>:root
	{
		--bg-dark: #0e0e10;
		--bg-darker: #141416;
		--bg-light: #1c1c1f;
		--text-main: #e5e7eb;
		--text-muted: #9ca3af;
		--accent: #ff6600;
		--border: #2a2a2d;
		--danger: #ef4444;
	}

	body {
		font-family: "Inter", system-ui, sans-serif;
		background: var(--bg-dark);
		color: var(--text-main);
		margin: 0;
		min-height: 100vh;
	}

	.admin-container {
		margin-left: 100px;
		padding: 2.5rem 3rem;
		background: var(--bg-dark);
		min-height: 100vh;
	}

	h1 {
		font-size: 2.3rem;
		font-weight: 800;
		color: #fff;
		display: flex;
		align-items: center;
		gap: 0.6rem;
		margin-bottom: 2.5rem;
	}

	.card {
		background: var(--bg-light);
		border: 1px solid var(--border);
		border-radius: 12px;
		padding: 2rem;
		box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
		max-width: 800px;
	}

	form label {
		display: block;
		font-weight: 600;
		color: var(--text-main);
		margin-bottom: 0.4rem;
	}

	form input[type="text"],
	form input[type="email"],
	form input[type="date"],
	form select {
		width: 100%;
		background: var(--bg-darker);
		color: var(--text-main);
		border: 1px solid var(--border);
		padding: 0.7rem 1rem;
		border-radius: 6px;
		font-size: 0.95rem;
		outline: none;
		transition: border-color 0.2s ease;
		margin-bottom: 1rem;
	}

	form input:focus,
	form select:focus {
		border-color: var(--accent);
	}

	.btn {
		display: inline-block;
		font-weight: 600;
		padding: 0.75rem 1.5rem;
		border-radius: 8px;
		cursor: pointer;
		border: none;
		text-decoration: none;
		text-align: center;
		transition: all 0.2s ease;
	}

	.btn-primary {
		background: var(--accent);
		color: #fff;
		box-shadow: 0 3px 10px rgba(255, 102, 0, 0.3);
	}
	.btn-primary:hover {
		background: #e25500;
		transform: translateY(-2px);
	}

	.btn-danger {
		background: var(--danger);
		color: #fff;
	}
	.btn-danger:hover {
		background: #dc2626;
	}

	.avantages-box {
		background: var(--bg-light);
		border: 1px solid var(--border);
		padding: 1rem 1.2rem;
		border-radius: 8px;
		margin-top: 1.5rem;
		color: var(--text-main);
	}

	.avantages-box h4 {
		margin-bottom: 0.6rem;
		font-size: 1.1rem;
		color: var(--accent);
	}

	.avantages-box ul li {
		margin-bottom: 0.3rem;
	}
</style>{% endblock %}{% block body %}
<div class="admin-container">
	<h1>üìù Modifier la licence #{{ licence.id }}</h1>

	<div class="card">
		{{ form_start(form) }}
		{{ form_widget(form) }}
		<button type="submit" class="btn btn-primary mt-3">üíæ Mettre √† jour</button>
		{{ form_end(form) }}
	</div>

	<form method="post" action="{{ path('admin_licence_delete', {id: licence.id}) }}" class="mt-4" onsubmit="return confirm('Confirmer la suppression ?')">
		<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ licence.id) }}">
		<button class="btn btn-danger mt-3">üóëÔ∏è Supprimer</button>
	</form>

</div>

 <script>
document.addEventListener('DOMContentLoaded', () => {
	const selectForfait = document.querySelector('#licence_forfait');
	if (!selectForfait) return;

	const avantagesBox = document.createElement('div');
	avantagesBox.classList.add('avantages-box');
	selectForfait.closest('.form-group')?.after(avantagesBox);

	selectForfait.addEventListener('change', async () => {
		const forfaitId = selectForfait.value;
		if (!forfaitId) {
			avantagesBox.innerHTML = '';
			return;
		}

		try {
			const resp = await fetch(`/admin/licences/forfait/${forfaitId}/avantages`);
			if (!resp.ok) throw new Error('Erreur r√©seau');
			const data = await resp.json();

			if (data.avantages && data.avantages.length > 0) {
				avantagesBox.innerHTML = `
					<h4>Avantages inclus dans le forfait <b>${data.nom}</b> :</h4>
					<ul>${data.avantages.map(a => `<li>‚úîÔ∏è ${a}</li>`).join('')}</ul>
				`;
			} else {
				avantagesBox.innerHTML = `<p style="color:#9ca3af;">Aucun avantage d√©fini pour ce forfait.</p>`;
			}
		} catch (e) {
			console.error(e);
			avantagesBox.innerHTML = `<p style="color:#ef4444;">Impossible de charger les avantages.</p>`;
		}
	});
});
</script>{% endblock %}
