{% extends 'admin/base_admin.html.twig' %}

{% block title %}Abonn√©s √† la newsletter
{% endblock %}

{% block stylesheets %}
	<style>:root
	{
		--bg-dark: #0e0e10;
		--bg-darker: #141416;
		--bg-light: #1c1c1f;
		--text-main: #e5e7eb;
		--text-muted: #9ca3af;
		--accent: #fff;
		--border: #2a2a2d;
	}

	/* --- CONTENEUR PRINCIPAL --- */
	.main-content {
		flex: 1;
		margin-left: 100px;
		padding: 2.5rem 3rem;
		background: var(--bg-dark);
		color: var(--text-main);
		box-sizing: border-box;
	}

	.dashboard-container {
		transform: scale(1.00); /* au lieu de 1.15 */
		transform-origin: top left;
		width: 243.9%; /* limite le d√©bordement */
		margin-left: 1.5rem; /* pour centrer l√©g√®rement √† cause de la sidebar */
	}

	.page-title {
		font-size: 2.2rem;
		font-weight: 800;
		color: #fff;
		margin-bottom: 2.5rem;
	}

	/* --- SECTION CARD --- */
	.section-card {
		background: var(--bg-light);
		border: 1px solid var(--border);
		padding: 1.8rem 1.6rem;
		margin-bottom: 2.2rem;
	}

	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		border-bottom: 1px solid var(--border);
		padding-bottom: 0.8rem;
		margin-bottom: 1.2rem;
	}

	.section-title {
		font-size: 1.1rem;
		font-weight: 600;
		color: #fff;
	}

	.table-toolbar {
		display: flex;
		gap: 0.6rem;
	}

	.search-bar {
		padding: 0.45rem 0.8rem;
		border: 1px solid var(--border);
		background: var(--bg-darker);
		color: var(--text-main);
		font-size: 0.9rem;
		outline: none;
	}
	.search-bar:focus {
		border-color: var(--accent);
	}

	/* --- TABLE --- */
	.table {
		width: 100%;
		border-collapse: collapse;
		font-size: 0.95rem;
		color: var(--text-main);
	}

	.table thead {
		background: var(--bg-darker);
		color: #fff;
	}
	.table th,
	.table td {
		padding: 0.8rem 1rem;
		text-align: left;
	}
	.table th {
		font-weight: 600;
		color: var(--accent);
		border-bottom: 2px solid var(--border);
	}
	.table tbody tr {
		border-bottom: 1px solid var(--border);
		transition: background 0.2s;
	}
	.table tbody tr:hover {
		background: rgba(255, 102, 0, 0.07);
	}

	/* --- STATUTS --- */
	.status-success {
		color: #22c55e;
		font-weight: 600;
	}
	.status-failed {
		color: #ef4444;
		font-weight: 600;
	}

	/* --- FLASH --- */
	.flash-success {
		background: linear-gradient(135deg,#2e7d32,#1b5e20);
		color: #fff;
		padding: 12px 16px;
		margin-bottom: 20px;
		text-align: center;
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
	}

	/* --- RESPONSIVE --- */
	@media(max-width: 900px) {
		.main-content {
			margin-left: 0;
			padding: 1.5rem;
		}
		.section-header {
			flex-direction: column;
			align-items: flex-start;
			gap: 1rem;
		}
	}
</style>{% endblock %}{% block body %}
<div class="main-content">
	<div class="dashboard-container">
		<h1 class="page-title">üíå Abonn√©s √† la newsletter</h1>

		{% for message in app.flashes('success') %}
			<div class="flash-success">{{ message }}</div>
		{% endfor %}

		<div class="section-card">
			<div class="section-header">
				<h3 class="section-title">Liste des abonn√©s</h3>
				<div class="table-toolbar">
					<input type="text" id="searchSubs" class="search-bar" placeholder="Rechercher...">
				</div>
			</div>

			{% if subscribers is not empty %}
				<div class="table-responsive">
					<table class="table" id="subsTable">
						<thead>
							<tr>
								<th>#</th>
								<th>Email</th>
								<th>Date d‚Äôinscription</th>
								<th>Confirm√©</th>
							</tr>
						</thead>
						<tbody>
							{% for s in subscribers %}
								<tr>
									<td>{{ loop.index }}</td>
									<td>{{ s.email }}</td>
									<td>{{ s.subscribedAt|date('d/m/Y H:i') }}</td>
									<td>
										{% if s.isConfirmed %}
											<span class="status-success">Oui</span>
										{% else %}
											<span class="status-failed">Non</span>
										{% endif %}
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			{% else %}
				<p style="text-align:center;color:var(--text-muted);">Aucun abonn√© trouv√©.</p>
			{% endif %}
		</div>
	</div>
</div>

 <script>
document.addEventListener('DOMContentLoaded', function(){
    const input = document.getElementById('searchSubs');
    const rows = document.querySelectorAll('#subsTable tbody tr');
    if (!input) return;

    input.addEventListener('keyup', function(){
        const q = this.value.toLowerCase();
        rows.forEach(r => {
            r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none';
        });
    });
});
</script>{% endblock %}
