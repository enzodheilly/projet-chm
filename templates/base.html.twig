<!DOCTYPE html>
<html lang="fr" data-theme="dark">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>
			{% block title %}
				CHM Saleux - Club d'Haltérophilie et de Musculation
			{% endblock %}
		</title>

		<!-- SEO -->
		<meta name="description" content="{% block description %}Club d'Haltérophilie et de Musculation de Saleux. École d'haltérophilie, formations tous niveaux, compétitions. Plus de 25 ans d'expérience.{% endblock %}">
		<meta name="keywords" content="haltérophilie, musculation, Saleux, club sportif, compétition, école, entraînement">
		<meta
		name="author" content="CHM Saleux">

		<!-- Open Graph -->
		<meta property="og:title" content="{% block og_title %}CHM Saleux - Club d'Haltérophilie et de Musculation{% endblock %}">
		<meta property="og:description" content="{% block og_description %}Rejoignez le CHM Saleux, club d'excellence en haltérophilie et musculation. École reconnue, entraîneurs diplômés, 25 ans d'expérience.{% endblock %}">
		<meta property="og:type" content="website">
		<meta
		property="og:url" content="{{ app.request.uri }}">

		<!-- Favicon -->
		<link
		rel="icon" type="image/png" href="{{ asset('images/favicon/icon.png') }}">

		<!-- Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
		<link
		rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>


		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

		<!-- Lucide Icons -->
		 <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"
																																		            defer
																																		            nonce="{{ csp_nonce('script') }}"></script>
		<link
		rel="stylesheet" href="https://unpkg.com/lucide-static/font/lucide.css"> <!-- Bootstrap -->
		<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

		<!-- CSS global -->
		<link href="{{ asset('css/style.css') }}" rel="stylesheet">
		<link rel="stylesheet" href="{{ asset('css/nav/nav.css') }}">
		<link rel="stylesheet" href="{{ asset('css/footer/footer.css') }}"> {% block stylesheets %}{% endblock %}
		</head>

		<body
			class="bg-background text-foreground" style="margin:0; padding:0; width:100%;">

			{# Navbar #}
			{% block navbar %}
				{% include '/navbar/navigation.html.twig' %}
			{% endblock %}
		

			<main style="margin:0; padding:0; width:100%;"> {% block body %}{% endblock %}
				</main>

				{# Footer #}
				{% block footer %}
					{% include '/footer/footer.html.twig' %}

					{% block newsletter_script %}
						 <script src="{{ asset('js/footer/newsletter.js') }}"
																																																																																																						                    defer
																																																																																																						                    nonce="{{ csp_nonce('script') }}"></script>
					{% endblock %}
				{% endblock %}

				{# Assistant IA (sauf login/admin) #}
				{% if app.request.attributes.get('_route') not in ['app_login', 'admin_dashboard'] %}
					{% include 'assistant/assistant.html.twig' %}
				{% endif %}
				 <script src="{{ asset('js/app.js') }}"
																																																																				            nonce="{{ csp_nonce('script') }}"></script>

				 <script src="{{ asset('js/assistant/assistant.js') }}"
																																																																				            defer
																																																																				            nonce="{{ csp_nonce('script') }}"></script>

					{% block javascripts %}

					<!-- Chart.js -->
					 <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
																																																																																					            defer
																																																																																					            nonce="{{ csp_nonce('script') }}"></script>

					<!-- FullCalendar --> <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css"rel="stylesheet">  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"
																																																																																																						            defer
																																																																																																						            nonce="{{ csp_nonce('script') }}"></script>

					<!-- Mini toast CSS -->
						<style>
.toast-mini {
	position: fixed;
	right: 16px;
	bottom: 16px;
	background: #111;
	color: #fff;
	padding: 10px 14px;
	border-radius: 10px;
	box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
	opacity: 0;
	transform: translateY(10px);
	transition: 0.25s;
	z-index: 3000;
}
.toast-mini.show {
	opacity: 1;
	transform: none;
}
					</style>

					 <script nonce="{{ csp_nonce('script') }}">
																																																																																					        window.showToast = (msg) => {
																																																																																					            const t = document.createElement('div');
																																																																																					            t.className = 'toast-mini';
																																																																																					            t.textContent = msg;
																																																																																					            document.body.appendChild(t);
																																																																																					            requestAnimationFrame(() => t.classList.add('show'));
																																																																																					            setTimeout(() => {
																																																																																					                t.classList.remove('show');
																																																																																					                setTimeout(() => t.remove(), 200);
																																																																																					            }, 2200);
																																																																																					        };
																																																																																					    </script>

					<!-- CropperJS -->
					<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.css">  <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.js"
																																																																																																						            defer
																																																																																																						            nonce="{{ csp_nonce('script') }}"></script>

					<!-- Avatar Cropper Script -->
					 <script nonce="{{ csp_nonce('script') }}">
																																																																																					        document.addEventListener("DOMContentLoaded", () => {
																																																																																					            const avatarImg = document.getElementById('user-avatar-img');
																																																																																					            const fileInput = document.getElementById('avatar-file-input');
																																																																																					            if (!avatarImg || !fileInput) return;
																																																																																					
																																																																																					            let cropper;
																																																																																					            const modal = document.createElement("div");
																																																																																					            modal.id = "avatar-cropper-modal";
																																																																																					            modal.style.display = "none";
																																																																																					            modal.style.position = "fixed";
																																																																																					            modal.style.inset = "0";
																																																																																					            modal.style.background = "rgba(0,0,0,0.7)";
																																																																																					            modal.style.zIndex = "2000";
																																																																																					            modal.style.display = "none";
																																																																																					            document.body.appendChild(modal);
																																																																																					
																																																																																					            const container = document.createElement("div");
																																																																																					            container.innerHTML = `
																																																																																					                <div class="modal-content">
																																																																																					                    <h5 style="font-weight:600; margin-bottom:12px;">Ajustez votre photo</h5>
																																																																																					                    <img id="cropper-preview">
																																																																																					                    <div id="cropper-live-preview"></div>
																																																																																					                    <button id="cropper-save">Enregistrer</button>
																																																																																					                    <button id="cropper-cancel">Annuler</button>
																																																																																					                </div>
																																																																																					            `;
																																																																																					            modal.appendChild(container);
																																																																																					
																																																																																					            const previewImg = container.querySelector("#cropper-preview");
																																																																																					            const btnSave = container.querySelector("#cropper-save");
																																																																																					            const btnCancel = container.querySelector("#cropper-cancel");
																																																																																					
																																																																																					            fileInput.addEventListener("change", e => {
																																																																																					                const file = e.target.files[0];
																																																																																					                if (!file) return;
																																																																																					
																																																																																					                const reader = new FileReader();
																																																																																					                reader.onload = evt => {
																																																																																					                    previewImg.src = evt.target.result;
																																																																																					                    modal.style.display = "flex";
																																																																																					                    if (cropper) cropper.destroy();
																																																																																					
																																																																																					                    cropper = new Cropper(previewImg, {
																																																																																					                        aspectRatio: 1,
																																																																																					                        viewMode: 2,
																																																																																					                        dragMode: "move"
																																																																																					                    });
																																																																																					                };
																																																																																					                reader.readAsDataURL(file);
																																																																																					            });
																																																																																					
																																																																																					            btnCancel.addEventListener("click", () => {
																																																																																					                modal.style.display = "none";
																																																																																					                fileInput.value = "";
																																																																																					                if (cropper) cropper.destroy();
																																																																																					            });
																																																																																					
																																																																																					            btnSave.addEventListener("click", async () => {
																																																																																					                const canvas = cropper.getCroppedCanvas({
																																																																																					                    width: 300,
																																																																																					                    height: 300
																																																																																					                });
																																																																																					
																																																																																					                canvas.toBlob(async blob => {
																																																																																					                    const formData = new FormData();
																																																																																					                    formData.append("avatar", blob, "avatar.jpg");
																																																																																					                    formData.append("_csrf_token", "{{ csrf_token('profile_image') }}");
																																																																																					
																																																																																					                    const res = await fetch("{{ path('profile_photo_upload') }}", {
																																																																																					                        method: "POST",
																																																																																					                        body: formData
																																																																																					                    });
																																																																																					                    const data = await res.json();
																																																																																					
																																																																																					                    if (data.status === "ok") {
																																																																																					                        avatarImg.src = data.dataUrl;
																																																																																					                        showToast("Photo enregistrée !");
																																																																																					                    }
																																																																																					
																																																																																					                    modal.style.display = "none";
																																																																																					                    cropper.destroy();
																																																																																					                    fileInput.value = "";
																																																																																					                });
																																																																																					            });
																																																																																					        });
																																																																																					    </script>

					{% include 'modal/modal_auth.html.twig' %}
				<link rel="stylesheet" href="{{ asset('css/modal/modal.css') }}">  <script src="{{ asset('js/modal/modal.js') }}"
																																																																																					            defer
																																																																																					            nonce="{{ csp_nonce('script') }}"></script>

					<!-- Cloudflare Turnstile -->
					 <script src="https://challenges.cloudflare.com/turnstile/v0/api.js"
																																																																																					            async defer
																																																																																					            nonce="{{ csp_nonce('script') }}"></script>

				{% endblock %}
			</body>
		</html>
