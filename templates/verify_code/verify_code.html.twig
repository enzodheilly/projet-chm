{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/verify.css') }}">

	<style>
		/* ----------- PAGE VÉRIFICATION ----------- */
		body {
			font-family: 'Poppins', sans-serif;
			background: white;
			color: #333;
			margin: 0;
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			position: relative;
		}

		/* ----------- LOGO ----------- */
		.header-logo {
			position: absolute;
			top: 15px;
			left: 25px;
		}
		.header-logo img {
			height: 50px;
			width: auto;
		}

		/* ----------- CONTAINER ----------- */
		.verify-container {
			background: #ffffff;
			border-radius: 14px;
			padding: 1.8rem 1.6rem;
			width: 100%;
			max-width: 340px;
			box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
			text-align: center;
		}

		/* ----------- TITRE ET TEXTE ----------- */
		.verify-container h2 {
			color: #003366;
			font-size: 1.4rem;
			margin-bottom: 0.5rem;
			font-weight: 700;
		}
		.verify-container p {
			color: #666;
			font-size: 0.85rem;
			margin-bottom: 1.3rem;
		}

		/* ----------- CHAMP DE CODE ----------- */
		.input-group {
			margin-bottom: 1.2rem;
		}
		.input-group input {
			width: 100%;
			padding: 0.7rem;
			font-size: 1rem;
			text-align: center;
			letter-spacing: 5px;
			border-radius: 8px;
			border: 1.3px solid #ccc;
			background: #fafafa;
			transition: all 0.3s ease;
		}
		.input-group input:focus {
			border-color: #ff6600;
			background-color: #fff;
			box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.2);
			outline: none;
		}

		/* ----------- BOUTON ----------- */
		button[type="submit"] {
			width: 70%;
			padding: 0.8rem;
			background: #ff6600;
			border: none;
			border-radius: 8px;
			color: #fff;
			font-weight: 600;
			font-size: 0.9rem;
			cursor: pointer;
			transition: all 0.3s ease;
			margin-top: 0.3rem;
			display: flex;
			margin-left: 50px;
			align-items: center;
			justify-content: center;
			position: relative;
		}
		button[type="submit"]:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
		}
		button[disabled] {
			opacity: 0.8;
			cursor: not-allowed;
		}

		/* ----------- LIEN RENVOYER ----------- */
		.resend {
			font-size: 0.8rem;
			margin-top: 1rem;
			color: #555;
		}
		.resend a {
			color: #ff6600;
			font-weight: 600;
			text-decoration: none;
		}
		.resend a:hover {
			text-decoration: underline;
			color: #e65500;
		}

		/* ----------- FLASH MESSAGES ----------- */
		.flash-message {
			padding: 0.7rem 1rem;
			border-radius: 8px;
			margin-bottom: 1rem;
			font-size: 0.8rem;
			font-weight: 500;
			text-align: left;
			animation: fadeIn 0.3s ease;
			opacity: 1;
			transition: opacity 0.5s ease;
		}
		.flash-message.success {
			background-color: #e6ffed;
			color: #007a3d;
			border: 1px solid #8de0a4;
		}
		.flash-message.error {
			background-color: #ffe6e6;
			color: #cc0000;
			border: 1px solid #ff9999;
		}
		.flash-message.warning {
			background-color: #fff7e6;
			color: #b36b00;
			border: 1px solid #ffd580;
		}
		.flash-message.info {
			background-color: #e6f0ff;
			color: #0047b3;
			border: 1px solid #99c2ff;
		}

		/* Animations des flash messages */
		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(-8px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		@keyframes fadeOut {
			from {
				opacity: 1;
			}
			to {
				opacity: 0;
				transform: translateY(-8px);
			}
		}

		/* ----------- SPINNER GLOBAL ----------- */
		#loading-spinner {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(255, 255, 255, 0.8);
			z-index: 9999;
			justify-content: center;
			align-items: center;
			flex-direction: column;
		}

		.spinner {
			border: 5px solid #f3f3f3;
			border-top: 5px solid #ff6600;
			border-radius: 50%;
			width: 60px;
			height: 60px;
			animation: spin 0.9s linear infinite;
		}

		.spinner-text {
			margin-top: 1rem;
			font-weight: 500;
			color: #003366;
			font-size: 0.95rem;
			animation: blink 2s ease-in-out infinite;
		}

		@keyframes spin {
			from {
				transform: rotate(0deg);
			}
			to {
				transform: rotate(360deg);
			}
		}
		@keyframes blink {
			0,
			100% {
				opacity: 1;
			}
			50% {
				opacity: 0.5;
			}
		}

		/* ----------- RESPONSIVE ----------- */
		@media(max-width: 600px) {
			.verify-container {
				margin: 2rem 1rem;
				padding: 1.5rem 1.2rem;
			}
			.header-logo img {
				height: 45px;
			}
		}
	</style>
{% endblock %}

{% block body %}
	<div class="header-logo">
		<img src="{{ asset('images/logo-chm.png') }}" alt="CHM Saleux Logo">
	</div>

	<div
		class="verify-container">

		{# ✅ Messages flash #}
		{% for label, messages in app.flashes %}
			{% for message in messages %}
				<div class="flash-message {{ label }}">
					{{ message }}
				</div>
			{% endfor %}
		{% endfor %}

		<h2>Vérification de votre compte</h2>
		<p>Entrez le code à 6 chiffres que vous avez reçu par e-mail.</p>

		<form method="POST" id="verify-form">
			<div class="input-group">
				<input type="text" name="code" maxlength="6" pattern="\d{6}" placeholder="Code à 6 chiffres" required>
			</div>

			<button type="submit" id="verifyButton">Vérifier mon compte</button>
		</form>

		<p class="resend">
			Vous n'avez pas reçu de code ?
			<a href="{{ path('app_resend_code') }}">Renvoyer un nouveau code</a>
		</p>
	</div>

	<!-- ✅ Spinner global -->
	<div id="loading-spinner">
		<div class="spinner"></div>
		<div class="spinner-text">Vérification en cours...</div>
	</div>

	 <script>
				// ✅ Disparition automatique des flash messages
				setTimeout(() => {
					document.querySelectorAll('.flash-message').forEach(msg => {
						msg.style.animation = 'fadeOut 0.5s forwards';
						setTimeout(() => msg.remove(), 600);
					});
				}, 4000);
				
				// ✅ Affiche la roue de chargement globale
				document.getElementById("verify-form").addEventListener("submit", function() {
					document.getElementById("loading-spinner").style.display = "flex";
				});
				</script>
{% endblock %}
