{% block stylesheets %}

	<style>
		/* ----------- PAGE CONNEXION ----------- */
		body {
			font-family: 'Poppins', sans-serif;
			background: white;
			color: #333;
			margin: 0;
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			position: relative;
		}

		/* ----------- LOGO ----------- */
		.header-logo {
			position: absolute;
			top: 15px;
			left: 25px;
		}
		.header-logo img {
			height: 50px;
			width: auto;
		}

		/* ----------- CONTAINER ----------- */
		.login-container {
			background: #fff;
			border-radius: 14px;
			padding: 1.8rem 1.6rem;
			width: 100%;
			max-width: 340px;
			box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
			text-align: center;
			margin-top: 2rem;
		}
		.login-container h1 {
			color: #003366;
			font-size: 1.4rem;
			margin-bottom: 0.3rem;
		}
		.login-container p {
			color: #666;
			font-size: 0.85rem;
			margin-bottom: 1.3rem;
		}

		/* ----------- FORM ----------- */
		.input-group {
			text-align: left;
			margin-bottom: 0.9rem;
			position: relative;
		}
		label {
			display: block;
			margin-bottom: 0.25rem;
			font-weight: 500;
			color: #003366;
			font-size: 0.8rem;
		}
		input[type="email"],
		input[type="password"],
		input[type="text"] {
			width: 100%;
			padding: 0.7rem;
			border: 1.3px solid #ddd;
			border-radius: 8px;
			font-size: 0.85rem;
			background: #fafafa;
			transition: all 0.3s ease;
		}
		input:focus {
			border-color: #ff6600;
			background-color: #fff;
			box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.2);
			outline: none;
		}

		/* ----------- IC√îNE ≈íIL ----------- */
		.toggle-password {
			position: absolute;
			right: 10px;
			top: 40px;
			transform: translateY(-50%);
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.toggle-password img {
			width: 18px;
			height: 18px;
			opacity: 0.6;
			transition: opacity 0.3s ease, transform 0.2s ease;
		}
		.toggle-password img.hide {
			display: none;
		}

		/* ----------- CHECKBOX ‚ÄúSE SOUVENIR DE MOI‚Äù ----------- */
		.remember-me {
			display: flex;
			align-items: center;
			gap: 0.4rem;
			margin: 0.5rem 0 1.2rem;
			font-size: 0.8rem;
			color: #333;
			text-align: left;
		}
		.remember-me input[type="checkbox"] {
			appearance: none;
			width: 16px;
			height: 16px;
			border: 1.3px solid #bbb;
			border-radius: 4px;
			cursor: pointer;
			position: relative;
			transition: all 0.2s ease;
			background: #fff;
		}
		.remember-me input[type="checkbox"]:hover {
			border-color: #ff6600;
		}
		.remember-me input[type="checkbox"]:checked {
			border-color: #ff6600;
			background-color: #ff6600;
		}
		.remember-me input[type="checkbox"]:checked::after {
			content: '‚úî';
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -55%);
			color: #fff;
			font-size: 0.65rem;
			font-weight: bold;
		}
		.remember-me label {
			cursor: pointer;
			color: #333;
		}

		/* ----------- BOUTON ----------- */
		button[type="submit"] {
			width: 70%;
			padding: 0.8rem;
			background: #ff6600;
			border: none;
			border-radius: 8px;
			color: #fff;
			font-weight: 600;
			font-size: 0.9rem;
			cursor: pointer;
			transition: all 0.3s ease;
			margin-top: 0.3rem;
			margin-left: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
		}
		button[type="submit"]:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
		}
		button[disabled] {
			opacity: 0.8;
			cursor: not-allowed;
		}

		/* ----------- LIEN INSCRIPTION ----------- */
		.register-link {
			margin-top: 1.2rem;
			font-size: 0.8rem;
			color: #555;
		}
		.register-link a {
			color: #ff6600;
			font-weight: 600;
			text-decoration: none;
		}
		.register-link a:hover {
			text-decoration: underline;
			color: #e65500;
		}

		/* ----------- FLASH MESSAGES ----------- */
		.flash-message {
			padding: 0.7rem 1rem;
			border-radius: 8px;
			margin-bottom: 1rem;
			font-size: 0.8rem;
			font-weight: 500;
			text-align: left;
		}
		.flash-message.success {
			background-color: #e6ffed;
			color: #007a3d;
			border: 1px solid #8de0a4;
		}
		.flash-message.warning {
			background-color: #fff7e6;
			color: #b36b00;
			border: 1px solid #ffd580;
		}
		.flash-message.error {
			background-color: #ffe6e6;
			color: #cc0000;
			border: 1px solid #ff9999;
		}
		.flash-message.info {
			background-color: #e6f0ff;
			color: #0047b3;
			border: 1px solid #99c2ff;
		}

		.forgot-password {
			margin-top: 0.8rem;
			font-size: 0.8rem;
		}
		.forgot-password a {
			color: #003366;
			text-decoration: none;
			font-weight: 500;
		}
		.forgot-password a:hover {
			text-decoration: underline;
			color: #ff6600;
		}

		/* ----------- SPINNER GLOBAL ----------- */
		#loading-spinner {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(255, 255, 255, 0.8);
			z-index: 9999;
			justify-content: center;
			align-items: center;
			flex-direction: column;
		}

		.spinner {
			border: 5px solid #f3f3f3;
			border-top: 5px solid #ff6600;
			border-radius: 50%;
			width: 60px;
			height: 60px;
			animation: spin 0.9s linear infinite;
		}

		.spinner-text {
			margin-top: 1rem;
			font-weight: 500;
			color: #003366;
			font-size: 0.95rem;
		}

		@keyframes spin {
			from {
				transform: rotate(0deg);
			}
			to {
				transform: rotate(360deg);
			}
		}
	</style>
{% endblock %}

{% block body %}
	<div class="header-logo">
		<img src="{{ asset('images/logo-chm.png') }}" alt="CHM Saleux Logo">
	</div>

	<div
		class="login-container">

		{# üîî Messages flash standard #}
		{% for label, messages in app.flashes %}
			{% for message in messages %}
				<div class="flash-message {{ label }}">{{ message }}</div>
			{% endfor %}
		{% endfor %}

		{# üì® Message sp√©cial si redirig√© depuis la newsletter #}
		{% if app.request.get('newsletter_required') %}
			<div class="flash-message info">
				<strong>‚ÑπÔ∏è</strong>
				Veuillez vous connecter pour vous abonner √† la newsletter.
			</div>
		{% endif %}

		<h1>Connexion</h1>
		<p>Heureux de vous revoir ! Connectez-vous √† votre compte.</p>

		{# juste avant ton formulaire #}
		{% set redirect = app.request.get('redirect') ?? app.request.query.get('redirect') %}

		<form method="post" action="{{ path('app_login', { redirect: app.request.get('redirect') }) }}" id="login-form">
			<input
			type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

			{# ‚úÖ Champ cach√© pour conserver l‚ÄôURL de redirection (ex: /paiement/loisir) #}
			{% if app.request.get('redirect') %}
				<input type="hidden" name="redirect" value="{{ app.request.get('redirect') }}">
			{% endif %}

			<div class="input-group">
				<label for="email">Adresse e-mail</label>
				<input type="email" id="email" name="email" value="{{ last_username }}" required autofocus>
			</div>

			<div class="input-group">
				<label for="password">Mot de passe</label>
				<input type="password" id="password" name="password" required>
				<span class="toggle-password" onclick="togglePassword()">
					<img id="eyeOpen" src="{{ asset('images/oeil1.png') }}" alt="Afficher">
					<img id="eyeClosed" src="{{ asset('images/oeil2.png') }}" alt="Cacher" class="hide">
				</span>
			</div>

			<div class="remember-me">
				<input type="checkbox" id="remember_me" name="_remember_me">
				<label for="remember_me">Se souvenir de moi</label>
			</div>

			<button type="submit" id="loginButton">Se connecter</button>
		</form>

		<p class="register-link">
			Pas encore de compte ?
			<a href="{{ path('app_register') }}">Cr√©er un compte</a>
		</p>

		<p class="forgot-password">
			<a href="{{ path('app_reset_password_request') }}">Mot de passe oubli√© ?</a>
		</p>
	</div>

	<!-- ‚úÖ Spinner global -->
	<div id="loading-spinner">
		<div class="spinner"></div>
		<div class="spinner-text">Connexion en cours...</div>
	</div>

	 <script>
										function togglePassword() {
											const input = document.getElementById("password");
											const eyeOpen = document.getElementById("eyeOpen");
											const eyeClosed = document.getElementById("eyeClosed");
										
											if (input.type === "password") {
												input.type = "text";
												eyeOpen.classList.add("hide");
												eyeClosed.classList.remove("hide");
											} else {
												input.type = "password";
												eyeClosed.classList.add("hide");
												eyeOpen.classList.remove("hide");
											}
										}
									
										// ‚úÖ Spinner visible lors de la soumission
										document.getElementById("login-form").addEventListener("submit", function() {
											document.getElementById("loading-spinner").style.display = "flex";
										});
									
										// ‚úÖ Disparition progressive des flash messages
										setTimeout(() => {
											document.querySelectorAll('.flash-message').forEach(msg => {
												msg.style.transition = 'opacity 0.5s ease';
												msg.style.opacity = '0';
												setTimeout(() => msg.remove(), 500);
											});
										}, 4000);
										</script>
{% endblock %}
