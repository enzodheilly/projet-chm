{% extends 'base.html.twig' %}

{% block title %}Actualités
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('css/accueil/section4/actualites/articles.css') }}">
{% endblock %}
{% block body %}
	<main>
		<section class="page-banner">
			<h1>Actualités</h1>
		</section>

		<section class="filter-bar">
			<form method="get" action="{{ path('actualites', {'page': 1}) }}">
				{% if categories is defined %}
					<select name="categorie">
						<option value="">Toutes les catégories</option>
						{% for cat in categories %}
							<option value="{{ cat.id }}" {% if filters.categorie is defined and filters.categorie == cat.id %} selected {% endif %}>
								{{ cat.name }}
							</option>
						{% endfor %}
					</select>
				{% else %}
					<select disabled>
						<option>Toutes les catégories</option>
					</select>
				{% endif %}

				<!-- Champ date "De" avec bouton reset -->
				<div class="date-input">
					<label for="date_from">De :</label>
					<div class="input-wrapper">
						<input type="date" id="date_from" name="date_from" value="{{ filters.date_from is defined ? filters.date_from : '' }}">
						<span class="clear-icon" title="Effacer la date" onclick="clearDate('date_from')">×</span>
					</div>
				</div>

				<div class="date-input">
					<label for="date_to">À :</label>
					<div class="input-wrapper">
						<input type="date" id="date_to" name="date_to" value="{{ filters.date_to is defined ? filters.date_to : '' }}">
						<span class="clear-icon" title="Effacer la date" onclick="clearDate('date_to')">×</span>
					</div>
				</div>


				<button type="submit">Rechercher</button>
			</form>
		</section>


		<section class="actualites-section">
			{% if articles is not empty %}
				<ul class="news-grid">
					{% for article in articles %}
						<li class="news-card">
							<img src="{{ asset(article.image) }}" alt="{{ article.title }}">
							<div class="news-info">
								<span class="news-category">{{ article.categorie.name|upper }}</span>

								<h3>{{ article.title }}</h3>
								<p>{{ article.summary|length > 130 ? article.summary|slice(0,130) ~ '...' : article.summary }}</p>
								<span class="news-date">{{ article.publishedAt|date('d/m/Y') }}</span>
								<a href="{{ path('article_show', {'id': article.id}) }}">Lire la suite</a>

							</div>
						</li>

					{% endfor %}
				</ul>

				<div class="pagination">
					{% set query = {
        'categorie': filters.categorie,
        'date_from': filters.date_from,
        'date_to': filters.date_to
    } %}

					{# Bouton "Précédent" #}
					{% if page > 1 %}
						<a href="{{ path('actualites', query|merge({'page': page - 1})) }}" class="page-arrow">&lsaquo;</a>
					{% else %}
						<span class="page-arrow disabled">&lsaquo;</span>
					{% endif %}

					{# Calcul de la plage de pages à afficher #}
					{% set start = (page > 3) ? page - 2 : 1 %}
					{% set end = (page < totalPages - 2) ? page + 2 : totalPages %}

					{% if start > 1 %}
						<a href="{{ path('actualites', query|merge({'page': 1})) }}">1</a>
						{% if start > 2 %}
							<span class="dots">...</span>
						{% endif %}
					{% endif %}

					{% for i in start..end %}
						{% if i == page %}
							<span class="current">{{ i }}</span>
						{% else %}
							<a href="{{ path('actualites', query|merge({'page': i})) }}">{{ i }}</a>
						{% endif %}
					{% endfor %}

					{% if end < totalPages %}
						{% if end < totalPages - 1 %}
							<span class="dots">...</span>
						{% endif %}
						<a href="{{ path('actualites', query|merge({'page': totalPages})) }}">{{ totalPages }}</a>
					{% endif %}

					{# Bouton "Suivant" #}
					{% if page < totalPages %}
						<a href="{{ path('actualites', query|merge({'page': page + 1})) }}" class="page-arrow">&rsaquo;</a>
					{% else %}
						<span class="page-arrow disabled">&rsaquo;</span>
					{% endif %}
				</div>

			{% else %}
				<p style="text-align:center; color:#777;">Aucune actualité pour le moment.</p>
			{% endif %}
		</section>
	</main>
{% endblock %}

{% block javascripts %}
	 <script src="{{ asset('js/accueil/section4/actualites/articles.js') }}"></script>
{% endblock %}
