<footer
	class="footer-chm">
	{# ‚úÖ Emp√™che les erreurs Twig si les variables ne sont pas d√©finies #}
	{% if isSubscribed is not defined %}
		{% set isSubscribed = false %}
	{% endif %}
	{% if subscriber is not defined %}
		{% set subscriber = null %}
	{% endif %}

	<div
		class="footer-container">

		<!-- Bloc identit√© -->
		<div class="footer-column footer-brand">
			<h3>CHM SALEUX</h3>
			<p>Club d‚ÄôHalt√©rophilie & Musculation √† Saleux. Un lieu convivial pour se d√©passer, progresser et partager la passion du sport.</p>
		</div>

		<!-- Bloc r√©seaux sociaux -->
		<div class="footer-column socials">
			<h4>Suivez-nous</h4>
			<div class="social-icons">
				<a href="#" aria-label="Facebook">
					<i class="fab fa-facebook-f"></i>
				</a>
				<a href="#" aria-label="Instagram">
					<i class="fab fa-instagram"></i>
				</a>
				<a href="#" aria-label="YouTube">
					<i class="fab fa-youtube"></i>
				</a>
			</div>
		</div>

		<!-- Bloc contact -->
		<div class="footer-column contact">
			<h4>Nous contacter</h4>
			<ul>
				<li>
					<strong>Adresse :</strong>
					12 Rue du Stade, 80480 Saleux</li>
				<li>
					<strong>T√©l√©phone :</strong>
					03 22 00 00 00</li>
				<li>
					<strong>Email :</strong>
					<a href="mailto:contact@chmsaleux.fr">contact@chmsaleux.fr</a>
				</li>
			</ul>
		</div>

		<!-- Bloc newsletter -->
		<div class="footer-column newsletter">
			<h4>Abonnez-vous √† notre newsletter</h4>

			{% if app.user and isSubscribed %}
				<!-- ‚úÖ L'utilisateur connect√© est d√©j√† abonn√© -->
				<p class="already-subscribed">
					‚úÖ Vous √™tes d√©j√† abonn√© √† notre newsletter avec votre adresse
					<strong>{{ app.user.email }}</strong>.<br>

					<a href="{{ path('newsletter_unsubscribe', {'token': subscriber.unsubscribeToken}) }}" class="unsubscribe-link">
						Se d√©sabonner
					</a>
				</p>

			{% else %}
				<!-- üì® Formulaire d‚Äôabonnement -->
				<p>Recevez les derni√®res actualit√©s, √©v√©nements et infos du CHM directement dans votre bo√Æte mail.</p>

				<form id="newsletter-form" method="POST" action="{{ path('newsletter_subscribe') }}">
					<input type="hidden" name="_csrf_token" value="{{ csrf_token('newsletter') }}">

					<div class="newsletter-form">
						<div class="newsletter-inputs">
							<input type="email" name="email" placeholder="Votre email" value="{{ app.user ? app.user.email : '' }}" required>

							<button type="submit" id="newsletter-submit">
								<span class="btn-text">S‚Äôabonner</span>
								<span class="icon-layer">
									<span class="spinner"></span>
									<span class="checkmark">‚úî</span>
								</span>
							</button>
						</div>

						<div class="cf-turnstile" data-sitekey="{{ turnstile_site_key }}" data-theme="dark"></div>
					</div>

					<div style="display:none;">
						<label for="nickname">Ne pas remplir ce champ</label>
						<input type="text" name="nickname" id="nickname" autocomplete="off">
					</div>

					<div id="newsletterSuccess" class="newsletter-feedback newsletter-success"></div>
					<div id="newsletterError" class="newsletter-feedback newsletter-error"></div>
				</form>

				 <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
			{% endif %}
		</div>
	</div>

	<!-- Liens l√©gaux -->
	<div class="footer-links">
		<a href="{{ path('page_show', {'slug': 'mentions-legales'}) }}">Mentions l√©gales</a>
		<a href="{{ path('page_show', {'slug': 'conditions-utilisation'}) }}">Conditions d‚Äôutilisation</a>
		<a href="{{ path('page_show', {'slug': 'confidentialite'}) }}">Politique de confidentialit√©</a>
		<a href="{{ path('page_show', {'slug': 'cookies'}) }}">Cookies</a>
	</div>

	<!-- Copyright -->
	<div class="footer-bottom">
		<p>&copy; 2025 CHM SALEUX - Tous droits r√©serv√©s</p>
	</div>
</footer>

 <script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('newsletter-form');
  if (!form) return; // s√©curit√©

  const button = document.getElementById('newsletter-submit');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    button.disabled = true;
    button.classList.add('loading');
    button.classList.remove('success');

    try {
      const formData = new FormData(form);
      const response = await fetch(form.action, {
        method: form.method,
        body: formData
      });

      if (response.ok) {
        button.classList.remove('loading');
        button.classList.add('success');
      } else {
        throw new Error('Erreur');
      }

    } catch (err) {
      button.classList.remove('loading', 'success');
      button.disabled = false;
      alert("Une erreur est survenue, veuillez r√©essayer.");
    }
  });
});
</script>
